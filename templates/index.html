<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- نفس محتوى ملف HTML الذي أرسلته سابقاً -->
    <!-- يمكنك استخدام نفس التصميم مع إضافة الجزء البرمجي التالي -->
</head>
<body>
    <!-- ... -->

    <script>
        document.querySelector('.btn-download').addEventListener('click', async function() {
            const url = document.querySelector('.url-input').value.trim();
            const btn = this;
            
            if (!url) {
                alert('الرجاء إدخال رابط الفيديو');
                return;
            }
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحميل...';
            btn.disabled = true;
            
            try {
                const response = await fetch('/download', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `url=${encodeURIComponent(url)}`
                });
                
                const data = await response.json();
                
                if (data.error) {
                    alert(data.error);
                } else {
                    alert(`تم تحضير فيديو ${data.platform} للتحميل!`);
                    // تحميل الملف تلقائياً
                    window.location.href = data.download_url;
                }
            } catch (error) {
                alert('حدث خطأ أثناء الاتصال بالخادم');
                console.error(error);
            } finally {
                btn.innerHTML = '<i class="fas fa-download"></i> تحميل الفيديو';
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
